<ng-container *transloco="let t">
    <section class="v-ui-reset-password">
        <h1 class="v-ui-reset-password__header">პაროლის აღდგენა</h1>

        <form class="v-ui-reset-password__form" [formGroup]="resetPasswordForm">
            @if (!showMobileVerification()) {
                <div class="d-flex flex-column gap-2 mb-5">
                    <v-ui-form-item>
                        <v-ui-form-item-label>პირადი ნომერი ან პასპორტის ნომერი</v-ui-form-item-label>
                        <input v-ui-input formControlName="personalNumber" />
                        <v-ui-form-error>
                            {{ personalNumberControl.errors | validationErrorPipe }}
                        </v-ui-form-error>
                    </v-ui-form-item>

                    <v-ui-form-item>
                        <v-ui-form-item-label>მობილური</v-ui-form-item-label>
                        <input v-ui-input formControlName="mobileNumber" />
                        <v-ui-form-error>
                            {{ mobileNumberControl.errors | validationErrorPipe }}
                        </v-ui-form-error>
                    </v-ui-form-item>
                </div>

                <button class="v-ui-reset-password__sign-in-btn" v-ui-button (click)="resetPassword()">
                    პაროლის აღდგენა
                </button>
            } @else {
                <v-ui-message-card messageCardType="info">
                    <p>ვერიფიკაციის ერთჯერადი კოდი გამოგზავნილია მობილურის ნომერზე: {{ mobileNumberControl.value }}</p>
                </v-ui-message-card>

                <div class="d-flex flex-column align-items-center mt-5">
                    <v-ui-form-item borderless [removeClearBtn]="true">
                        <v-ui-verification formControlName="verificationNumber" />
                        <v-ui-form-error [messageAlignedAtStart]="false"
                            >{{ verificationNumberControl.errors | validationErrorPipe }}
                        </v-ui-form-error>
                    </v-ui-form-item>
                    <v-ui-timer (resendBtnClicked)="resetPassword()"></v-ui-timer>
                </div>

                <div class="d-flex flex-column gap-2 mb-5">
                    <v-ui-form-item>
                        <v-ui-form-item-label>ახალი პაროლი</v-ui-form-item-label>
                        <input v-ui-input formControlName="password" type="password" />
                        <v-ui-form-error>
                            {{ passwordControl.errors | validationErrorPipe }}
                        </v-ui-form-error>
                    </v-ui-form-item>

                    <v-ui-form-item>
                        <v-ui-form-item-label>გაიმეორეთ პაროლი</v-ui-form-item-label>
                        <input v-ui-input formControlName="confirmPassword" type="password" />
                        <v-ui-form-error>
                            {{ confirmPasswordControl.errors | validationErrorPipe }}
                        </v-ui-form-error>
                    </v-ui-form-item>
                </div>

                <button class="v-ui-reset-password__sign-in-btn" v-ui-button (click)="saveNewPassword()">
                    პაროლის შეცვლა
                </button>
            }
        </form>
    </section>
</ng-container>

<ng-template #passwordChangedMessage>
    პაროლის ცვლილება წარმატებით განხორციელდა ! <a routerLink="/authentication">განაგრძეთ ავტორიზაცია.</a>
</ng-template>
