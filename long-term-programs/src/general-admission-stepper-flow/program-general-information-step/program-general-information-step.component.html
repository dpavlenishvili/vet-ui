@if (form(); as form) {
  <div class="k-w-full">
    <form [formGroup]="form">
      <div class="container">
        <div class="top-section">
          <div class="k-d-flex k-gap-4">
            <kendo-formfield>
              <kendo-label [text]="'shared.education' | transloco">
                <kendo-dropdownlist
                  [data]="educations$.value()"
                  textField="value"
                  valueField="id"
                  formControlName="education"
                  [valuePrimitive]="true"
                />
              </kendo-label>
            </kendo-formfield>
            <kendo-formfield>
              <kendo-label [text]="'shared.testCity' | transloco">
                <kendo-dropdownlist
                  [data]="cities$.value()"
                  textField="name"
                  valueField="id"
                  formControlName="district_id"
                  (valueChange)="districtChange()"
                  [valuePrimitive]="true"
                />
              </kendo-label>
            </kendo-formfield>
            <kendo-formfield>
              <kendo-label [text]="'shared.testLanguage' | transloco">
                <kendo-dropdownlist
                  [data]="languages$.value()"
                  textField="value"
                  valueField="id"
                  formControlName="language"
                  (valueChange)="languageChange()"
                  [valuePrimitive]="true"
                />
              </kendo-label>
            </kendo-formfield>
          </div>
          <div class="k-mt-3">
            <vet-file-upload
              [title]="'programs.uploadEducationDocument'"
              [uploadedFiles]="form?.get('doc')?.getRawValue()"
              (fileUploaded)="handleFileUpload($event, 'doc')"
              (fileRemoved)="handleRemoveFile($event, 'doc')"
            />
          </div>
        </div>
        <div class="section">
          <div class="title">
            <span>{{ 'programs.needAdaptedEnvironment' | transloco }}</span>
            <kendo-switch
              [onLabel]="'shared.yes' | transloco"
              [offLabel]="'shared.no' | transloco"
              [checked]="isSpecEnvEnabled()"
              (valueChange)="onSpecEnvSwitchChange($event)"
              #specEnvSwitch
            />
          </div>
          @if (specEnvSwitch.checked) {
            <div class="checkbox-selection-container">
              @for (specEnv of specEnvs(); track specEnv) {
                <div>
                  <input
                    type="checkbox"
                    kendoCheckBox
                    #specEnvCheckBox
                    [checked]="form?.get('spec_env')?.value.includes(specEnv)"
                    (change)="onSpecEnvChange(specEnvCheckBox.checked, specEnv)"
                  />
                  <kendo-label class="k-checkbox-label" [for]="specEnvCheckBox" [text]="specEnv | transloco" />
                  @if (
                    form.invalid &&
                    !form.untouched &&
                    specEnvSwitch.checked &&
                    form?.get('spec_env')?.value?.length === 0
                  ) {
                    <kendo-formerror>{{ 'shared.fieldIsRequired' | transloco }}</kendo-formerror>
                  }
                </div>
              }
            </div>
          }
        </div>

        <div class="section">
          <div class="title">
            <span>
              @if (user()?.residential === 'GEO') {
                {{ 'programs.completedForeignGeneralEducation' | transloco }}
              } @else {
                {{ 'programs.citizenOfCountryWithFamilyAbroad' | transloco }}
              }
            </span>
            <kendo-switch
              [onLabel]="'shared.yes' | transloco"
              [offLabel]="'shared.no' | transloco"
              [disabled]="abroadSwitch.checked"
              #ocuSwitch
              (valueChange)="
                toggleSwitcher($event, user()?.residential === 'GEO' ? 'abroad_doc' : 'complete_edu_abroad')
              "
              [checked]="isAbroadEnabled()"
            />
          </div>
          @if (ocuSwitch.checked && !abroadSwitch.checked) {
            <vet-info variant="warning">
              {{ 'programs.switchWarning' | transloco }}
            </vet-info>
            <vet-file-upload
              [title]="'programs.uploadEducationDocument'"
              [uploadedFiles]="form?.get('abroad_doc')?.getRawValue()"
              (fileUploaded)="handleFileUpload($event, 'abroad_doc')"
              (fileRemoved)="handleRemoveFile($event, 'abroad_doc')"
            />
          }
        </div>

        <div class="section">
          <div class="title">
            <span>
              @if (user()?.residential === 'GEO') {
                {{ 'programs.completedGeneralEducationInOccupiedTerritory' | transloco }}
              } @else {
                {{ 'programs.seekerRefugeeOrHumanitarianStatus' | transloco }}
              }
            </span>
            <kendo-switch
              [onLabel]="'shared.yes' | transloco"
              [offLabel]="'shared.no' | transloco"
              [disabled]="ocuSwitch.checked"
              #abroadSwitch
              (valueChange)="
                toggleSwitcher($event, user()?.residential === 'GEO' ? 'ocu_doc' : 'complete_base_edu_abroad')
              "
              [checked]="isOcuEnabled()"
            />
          </div>
          @if (abroadSwitch.checked && !ocuSwitch.checked) {
            <vet-info variant="warning">
              {{ 'programs.switchWarning' | transloco }}
            </vet-info>
            <vet-file-upload
              [title]="'programs.uploadEducationDocument'"
              [uploadedFiles]="form?.get('ocu_doc')?.getRawValue()"
              (fileUploaded)="handleFileUpload($event, 'ocu_doc')"
              (fileRemoved)="handleRemoveFile($event, 'ocu_doc')"
            />
          }
        </div>
      </div>
      <div class="k-display-flex k-justify-content-end">
        <button kendoButton themeColor="primary" (click)="onNextClick()">
          {{ 'auth.next' | transloco }}
        </button>
      </div>
    </form>
  </div>
}
