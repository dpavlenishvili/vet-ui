<ng-container *transloco="let t">
    <form [formGroup]="registrationForm">
        <v-ui-wizard [horizontal]="true">
            <v-ui-wizard-step id="1" title="მოქალაქეობის არჩევა">
                <ng-template vUiWizardStepContent>
                    <h1 class="wizard-step-header">აირჩიეთ მოქალაქეობა</h1>

                    <form formGroupName="chooseCitizenship" vUiWizardStepControlContent>
                        <v-ui-form-item [borderless]="true">
                            <v-ui-radio-button-group formControlName="citizenship">
                                <v-ui-radio-button [value]="citizenshipTypeEnum.Georgian">
                                    <span>საქართველოს მოქალაქე ან ბინადრობის მოწმობის მქონე</span>
                                </v-ui-radio-button>
                                <v-ui-radio-button [value]="citizenshipTypeEnum.Foreigner">
                                    <span>სხვა</span>
                                </v-ui-radio-button>
                            </v-ui-radio-button-group>
                            <v-ui-form-error>
                                <svg-icon [src]="exclamationPointIcon"></svg-icon>
                                გთხოვთ, მონიშნოთ ერთ-ერთი მნიშვნელობა
                            </v-ui-form-error>
                        </v-ui-form-item>
                    </form>
                </ng-template>
                <ng-template vUiWizardStepFooter let-next="next">
                    <div class="d-flex justify-content-end mt-2">
                        <button v-ui-button (click)="next(); citizenshipControl.markAsTouched()">გაგრძელება</button>
                    </div>
                </ng-template>
            </v-ui-wizard-step>

            <v-ui-wizard-step id="2" title="პიროვნების გადამოწმება">
                @if (citizenshipTypeEnum.Georgian === citizenshipValue) {
                    <ng-template vUiWizardStepContent>
                        <h1 class="wizard-step-header">მიუთითეთ პირადი ინფორმაცია</h1>

                        <form formGroupName="checkIdentity" vUiWizardStepControlContent>
                            <div class="d-flex gap-4">
                                <v-ui-form-item class="w-50" [hideClearBtn]="true">
                                    <v-ui-form-item-label>პირადი ნომერი</v-ui-form-item-label>
                                    <input v-ui-input formControlName="personalNumber" />
                                    <v-ui-form-error>
                                        <span>{{
                                            georgianCitizenPersonalNumberControl.errors | validationErrorPipe
                                        }}</span>
                                    </v-ui-form-error>
                                </v-ui-form-item>

                                <v-ui-form-item class="w-50" [hideClearBtn]="true">
                                    <v-ui-form-item-label>გვარი</v-ui-form-item-label>
                                    <input v-ui-input formControlName="lastname" />
                                    <v-ui-form-error>
                                        {{ georgianCitizenLastnameControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>
                            </div>
                            @if (userCheckedSuccessfully()) {
                                <div class="d-flex gap-4">
                                    <v-ui-form-item class="w-50" [hideClearBtn]="true">
                                        <v-ui-form-item-label>სახელი</v-ui-form-item-label>
                                        <input v-ui-input formControlName="firstname" [isDisabled]="true" />
                                        <v-ui-form-error>
                                            {{ georgianCitizenFirstnameControl.errors | validationErrorPipe }}
                                        </v-ui-form-error>
                                    </v-ui-form-item>

                                    <v-ui-form-item class="w-50" [calendarIcon]="true">
                                        <v-ui-form-item-label>დაბადების თარიღი</v-ui-form-item-label>
                                        <v-ui-datepicker
                                            formControlName="dateOfBirth"
                                            minDate="25/05/1930"
                                            maxDate="25/05/2010"
                                        ></v-ui-datepicker>
                                        <v-ui-form-error>
                                            {{ georgianCitizenDateOfBirthControl.errors | validationErrorPipe }}
                                        </v-ui-form-error>
                                    </v-ui-form-item>
                                </div>
                            }
                        </form>
                    </ng-template>
                    <ng-template vUiWizardStepFooter let-next="next" let-previous="previous">
                        <div class="d-flex justify-content-between mt-2">
                            <button v-ui-button (click)="previous()" color="secondary">უკან დაბრუნება</button>
                            @if (userCheckedSuccessfully()) {
                                <button v-ui-button (click)="next()">გაგრძელება</button>
                            } @else {
                                <button v-ui-button (click)="checkGeorgianUser()">შემოწმება</button>
                            }
                        </div>
                    </ng-template>
                } @else if (citizenshipValue === citizenshipTypeEnum.Foreigner) {
                    <ng-template vUiWizardStepContent>
                        <h1 class="wizard-step-header">მიუთითეთ პირადი ინფორმაცია</h1>

                        <form formGroupName="checkIdentityForeigner" vUiWizardStepControlContent>
                            <div class="d-flex gap-4">
                                <v-ui-form-item class="w-50" [removeClearBtn]="true">
                                    <v-ui-form-item-label>მოქალაქეობა</v-ui-form-item-label>
                                    <v-ui-dropdown
                                        [dropdownItems]="countries"
                                        bindLabel="name"
                                        bindValue="code"
                                        formControlName="citizenship"
                                    ></v-ui-dropdown>
                                    <v-ui-form-error>
                                        {{ foreignerCitizenshipControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>

                                <v-ui-form-item class="w-50" [hideClearBtn]="true">
                                    <v-ui-form-item-label>პირადი ნომერი ან პასპორტის ნომერი</v-ui-form-item-label>
                                    <input v-ui-input formControlName="personalNumber" />
                                    <v-ui-form-error>
                                        {{ foreignerPersonalNumberControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>
                            </div>

                            <div class="d-flex gap-4">
                                <v-ui-form-item class="w-50" [hideClearBtn]="true">
                                    <v-ui-form-item-label>სახელი</v-ui-form-item-label>
                                    <input v-ui-input formControlName="firstname" />
                                    <v-ui-form-error>
                                        {{ foreignerFirstnameControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>

                                <v-ui-form-item class="w-50" [hideClearBtn]="true">
                                    <v-ui-form-item-label>გვარი</v-ui-form-item-label>
                                    <input v-ui-input formControlName="lastname" />
                                    <v-ui-form-error>
                                        {{ foreignerLastnameControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>
                            </div>

                            <div class="d-flex gap-4">
                                <v-ui-form-item class="w-50" [calendarIcon]="true">
                                    <v-ui-form-item-label>დაბადების თარიღი</v-ui-form-item-label>
                                    <v-ui-datepicker
                                        formControlName="dateOfBirth"
                                        minDate="25/05/1930"
                                        maxDate="25/05/2010"
                                    ></v-ui-datepicker>
                                    <v-ui-form-error>
                                        {{ foreignerDateOfBirthControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>

                                <v-ui-form-item class="w-50" [removeClearBtn]="true">
                                    <v-ui-form-item-label>სქესი</v-ui-form-item-label>
                                    <v-ui-dropdown
                                        [dropdownItems]="genders"
                                        bindLabel="name"
                                        bindValue="code"
                                        formControlName="gender"
                                    ></v-ui-dropdown>
                                    <v-ui-form-error>
                                        {{ foreignerGenderControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>
                            </div>
                        </form>
                    </ng-template>
                    <ng-template vUiWizardStepFooter let-next="next" let-previous="previous">
                        <div class="d-flex justify-content-between mt-2">
                            <button v-ui-button (click)="previous()" color="secondary">უკან დაბრუნება</button>
                            <button v-ui-button (click)="checkForeignUser(next)">გაგრძელება</button>
                        </div>
                    </ng-template>
                }
            </v-ui-wizard-step>

            <v-ui-wizard-step id="3" title="მობილურის დადასტურება">
                <ng-template vUiWizardStepContent>
                    <h1 class="wizard-step-header">ჩაწერეთ მობილურის ნომერი</h1>

                    <form class="d-flex" formGroupName="mobile" vUiWizardStepControlContent>
                        <v-ui-form-item class="w-50" [hideClearBtn]="true">
                            <v-ui-form-item-label>მობილურის ნომერი</v-ui-form-item-label>
                            <input v-ui-input formControlName="mobileNumber" />
                            <v-ui-form-error>
                                {{ mobileNumberControl.errors | validationErrorPipe }}
                            </v-ui-form-error>
                        </v-ui-form-item>

                        <!-- Mobile number verification -->
                        <div class="w-50">
                            @if (smsSent()) {
                                <v-ui-form-item borderless [removeClearBtn]="true">
                                    <v-ui-verification
                                        [verified]="mobileVerified()"
                                        formControlName="verificationNumber"
                                    />
                                    <v-ui-form-error [messageAlignedAtStart]="false">
                                        {{ verificationNumberControl.errors | validationErrorPipe }}
                                    </v-ui-form-error>
                                </v-ui-form-item>
                                <v-ui-timer (resendBtnClicked)="sendSMS()"></v-ui-timer>
                            }
                        </div>
                    </form>
                </ng-template>
                <ng-template vUiWizardStepFooter let-next="next" let-previous="previous">
                    <div class="d-flex justify-content-between mt-2">
                        <button v-ui-button (click)="previous()" color="secondary">უკან დაბრუნება</button>
                        @if (smsSent()) {
                            <button v-ui-button (click)="next()">გაგრძელება</button>
                        } @else {
                            <button v-ui-button (click)="sendSMS()">შემოწმება</button>
                        }
                    </div>
                </ng-template>
            </v-ui-wizard-step>

            <v-ui-wizard-step id="4" title="პაროლის შექმნა">
                <ng-template vUiWizardStepContent>
                    <h1 class="wizard-step-header">შეიყვანეთ პაროლი</h1>

                    <form formGroupName="passwords" class="d-flex gap-4" vUiWizardStepControlContent>
                        <v-ui-form-item class="w-50" [hideClearBtn]="true">
                            <v-ui-form-item-label>პაროლი</v-ui-form-item-label>
                            <input v-ui-input formControlName="password" type="password" />
                            <v-ui-form-error>
                                {{ passwordControl.errors | validationErrorPipe }}
                            </v-ui-form-error>
                        </v-ui-form-item>

                        <v-ui-form-item class="w-50" [hideClearBtn]="true">
                            <v-ui-form-item-label>გაიმეორეთ პაროლი</v-ui-form-item-label>
                            <input v-ui-input formControlName="confirmPassword" type="password" />
                            <v-ui-form-error>
                                {{ confirmPasswordControl.errors | validationErrorPipe }}
                            </v-ui-form-error>
                        </v-ui-form-item>
                    </form>
                </ng-template>
                <ng-template vUiWizardStepFooter let-next="next" let-previous="previous">
                    <div class="d-flex justify-content-between mt-2">
                        <button v-ui-button (click)="previous()" color="secondary">უკან დაბრუნება</button>
                        <button v-ui-button (click)="confirmPassword(next)">გაგრძელება</button>
                    </div>
                </ng-template>
            </v-ui-wizard-step>

            <v-ui-wizard-step id="5" title="წესები და პირობები">
                <ng-template vUiWizardStepContent>
                    <h1 class="wizard-step-header">წესები და პირობები</h1>

                    <form formGroupName="termsAndConditions" vUiWizardStepControlContent>
                        <v-ui-form-item>
                            <div class="terms-and-conditions">
                                <p>
                                    თქვენს მიერ პროფესიული განათლების მიღების მსურველთა სარეგისტრაციო ვებ-გვერდზე
                                    (vet.emis.ge) განთავსებული ინფორმაცია „პერსონალურ მონაცემთა დაცვის შესახებ“
                                    საქართველოს კანონის თანახმად, შეიცავს პერსონალურ მონაცემებს, მათ შორის, შესაძლოა
                                    შეიცავდეს განსაკუთრებული კატეგორიის მონაცემებსაც. გთხოვთ, გაითვალისწინოთ, რო თქვენი
                                    პერსონალური მონაცემები შესაძლოა დამუშავდეს კანონმდებლობით გათვალისწინებულ მოთხოვნათა
                                    შესაბამისად.
                                </p>
                                <v-ui-checkbox formControlName="accepted">
                                    გავეცანი და ვეთანხმები წესებს
                                </v-ui-checkbox>
                                <v-ui-form-error>
                                    {{ termsAndConditionsAcceptedControl.errors | validationErrorPipe }}
                                </v-ui-form-error>
                            </div>
                        </v-ui-form-item>
                    </form>
                </ng-template>
                <ng-template vUiWizardStepFooter let-previous="previous">
                    <div class="d-flex justify-content-between mt-2">
                        <button v-ui-button (click)="previous()" color="secondary">უკან დაბრუნება</button>
                        <button v-ui-button [disabled]="!termsAndConditionsAcceptedControl.value" (click)="onSubmit()">
                            დასრულება
                        </button>
                    </div>
                </ng-template>
            </v-ui-wizard-step>
        </v-ui-wizard>
    </form>
</ng-container>

<ng-template #userAlreadyRegisteredErrorTemplate>
    მომხმარებელი უკვე რესგიტრირებულია, გთხოვთ <a routerLink="/authentication">გაიაროთ ავტორიზაცია</a>
</ng-template>
