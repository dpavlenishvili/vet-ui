import { ChangeDetectionStrategy, Component, computed, inject, input } from '@angular/core';
import { DomSanitizer } from '@angular/platform-browser';
import { TranslocoPipe } from '@jsverse/transloco';
import { SVGIconComponent } from '@progress/kendo-angular-icons';
import { vetIcons } from '@vet/shared';
import { RouterLink } from '@angular/router';
import { LongTerm, ShortProgram } from '@vet/backend';

@Component({
  selector: 'vet-program-card',
  imports: [TranslocoPipe, SVGIconComponent, RouterLink],
  templateUrl: './program-card.component.html',
  styleUrl: './program-card.component.scss',
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class ProgramCardComponent {
  program = input.required<ShortProgram | LongTerm>();
  programDetailsPath = input<string | null>(null);

  sanitizer = inject(DomSanitizer);
  sanitizedProgram = computed(() => ({
    ...this.program(),
    icon: this.sanitizer.bypassSecurityTrustHtml(
      `
        <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
          <rect width="60" height="60" rx="10" fill="#E3C7C9"/>
          <path d="M42.9875 22.0742C42.8244 21.7422 42.6237 21.5331 42.3603 21.447C42.1095 21.3609 41.8336 21.3978 41.5326 21.5454C41.0685 21.7668 40.479 22.0742 39.9397 22.48C39.1245 23.0826 38.3343 23.7098 37.5316 24.3369L36.6411 25.0256C36.5282 24.7919 36.4153 24.5583 36.3025 24.3246C34.6218 21.1888 32.013 19.172 28.5388 18.3235C25.4158 17.5733 22.3931 18.1267 19.5586 19.9959C18.4298 20.7461 17.6773 21.6315 17.2759 22.7014C17.2007 22.9104 17.138 23.1318 17.0878 23.3531L17.0125 23.636L17 24.5952L17.0878 25.001C17.1505 25.2469 17.2132 25.4929 17.301 25.7265C17.5268 26.3414 17.9407 26.8948 18.5803 27.399C18.7308 27.522 18.8939 27.645 19.0569 27.7679C19.2952 27.9524 19.5461 28.1369 19.7718 28.3336C20.1732 28.6533 20.3864 29.0715 20.3864 29.5019C20.3864 29.9323 20.1732 30.3504 19.7718 30.6824C19.5586 30.8669 19.3203 31.0391 19.0945 31.2235C18.8186 31.4326 18.5427 31.6416 18.2918 31.8753C17.5769 32.5025 17.1505 33.3141 17.0251 34.2979L17 34.3471L17.0125 35.3063L17.0627 35.5399C17.1003 35.7121 17.138 35.8843 17.2007 36.0564C17.5769 37.2247 18.3796 38.2085 19.5586 38.9955C21.5779 40.3236 23.6975 41 25.8924 41C26.7829 41 27.6734 40.8893 28.5765 40.6803C33.7564 39.4505 37.3811 35.0849 37.5692 29.8339C37.5692 29.797 37.5943 29.7355 37.6194 29.6986C37.9957 29.2436 38.3845 28.8009 38.7733 28.3459C39.4004 27.6081 40.04 26.8702 40.6797 26.0832C41.5326 25.0379 42.4231 23.968 42.9749 22.6768L43 22.2095L42.9875 22.0742ZM31.2229 31.9737C34.0699 29.2928 36.9045 26.6858 40.0024 24.3492C39.438 25.0748 38.8736 25.8249 38.2716 26.5382C36.5658 28.5796 34.6093 30.707 32.3266 33.0435L31.2229 31.9737ZM21.9542 29.5019C21.9542 28.5427 21.4776 27.6327 20.6498 27.0055C20.5118 26.9071 20.3613 26.7964 20.2233 26.6858C20.0227 26.5259 19.8345 26.3783 19.6339 26.243C19.0695 25.8249 18.7183 25.2592 18.6179 24.5829C18.5051 23.8573 18.7057 23.0949 19.1573 22.5046C19.8345 21.6069 20.7752 20.9305 22.1172 20.3649C23.4216 19.8238 24.6507 19.5532 25.8548 19.5532C26.1558 19.5532 26.4568 19.5655 26.7578 19.6024C30.1819 19.9836 32.8157 21.6438 34.5967 24.5091C34.7849 24.8042 34.9228 25.124 35.0733 25.456C35.1611 25.6528 35.2615 25.8618 35.3869 26.0832C35.3869 26.0832 35.3743 26.1078 35.3116 26.157C35.0357 26.4029 34.7723 26.6489 34.4964 26.8825C34.5215 26.7718 34.534 26.6612 34.534 26.5505C34.5591 25.9356 34.3208 25.333 33.8818 24.8903C33.4428 24.4476 32.8408 24.1894 32.2137 24.1771C32.2012 24.1771 32.1886 24.1771 32.1761 24.1771C30.8842 24.1771 29.8432 25.1855 29.8056 26.489C29.7931 27.067 30.0188 27.6204 30.4327 28.0631C30.8842 28.5181 31.5113 28.7886 32.151 28.8132C32.1635 28.8132 32.1761 28.8132 32.2012 28.8132C32.2639 28.8132 32.3266 28.8009 32.3893 28.7886C31.9503 29.1821 31.4988 29.588 31.0598 29.9815C30.8591 30.1659 30.6585 30.3627 30.4578 30.5472C30.2571 30.7439 30.0564 30.9407 29.8432 31.1251C29.768 31.1989 29.6551 31.2481 29.5548 31.2727C27.987 31.5432 26.9711 32.3549 26.5321 33.6707C26.4192 34.015 26.3314 34.3594 26.2436 34.716C26.206 34.8882 26.1558 35.0603 26.1182 35.2325L26.1056 35.3432C26.0555 35.5276 26.0053 35.7121 25.9426 35.8966C25.8423 36.1794 25.6416 36.327 25.3155 36.3762L25.2277 36.3885C24.6884 36.4868 24.5504 36.8435 24.5253 37.0402C24.4626 37.446 24.6633 37.7535 25.0772 37.901C26.0931 38.27 27.109 38.4544 28.1124 38.4544C29.0154 38.4298 29.8056 38.2823 30.5205 37.9256C31.712 37.3231 32.5022 36.3393 32.9411 34.8882C33.0164 34.6422 33.1042 34.47 33.2672 34.3102C34.0323 33.5231 34.7849 32.7238 35.5499 31.9368L35.7381 31.74C35.6879 31.9491 35.6377 32.1458 35.575 32.3426C34.3083 36.0687 31.712 38.3806 27.8616 39.2292C25.1023 39.8317 22.4809 39.2292 20.0854 37.4337C19.3705 36.9049 18.919 36.2901 18.7057 35.5645C18.3922 34.5192 18.7057 33.5108 19.5712 32.8222C19.9223 32.5393 20.2735 32.2688 20.6372 32.0106C21.465 31.3834 21.9542 30.4734 21.9542 29.5019ZM27.987 36.8926C27.7361 36.8926 27.4853 36.8558 27.2094 36.8312C27.4978 36.3393 27.6107 35.8228 27.7236 35.3186C27.7612 35.1587 27.7988 34.9988 27.8365 34.839C27.9117 34.5438 28.0246 34.1626 28.1877 33.8183C28.451 33.2649 28.9402 32.9575 29.8056 32.7976C30.3449 33.3264 30.8842 33.8552 31.411 34.3963C31.1476 35.3186 30.7337 35.9457 30.0941 36.3639C29.5548 36.7451 28.89 36.9172 27.987 36.8926ZM32.9662 26.5013C32.9662 26.7103 32.891 26.8948 32.7405 27.0424C32.59 27.1899 32.4018 27.2637 32.2012 27.2637C31.7496 27.2637 31.3859 26.9194 31.3859 26.5013C31.3859 26.3045 31.4737 26.1201 31.6117 25.9725C31.7622 25.8249 31.9629 25.7388 32.1635 25.7388C32.3767 25.7388 32.59 25.8249 32.7405 25.9725C32.891 26.1078 32.9662 26.3045 32.9662 26.5013Z" fill="white"/>
          <path d="M22.056 27.1402C22.6956 27.1402 23.2851 26.9066 23.7366 26.4884C24.1881 26.058 24.439 25.48 24.439 24.8529C24.4515 23.5862 23.4231 22.5287 22.1437 22.5164C22.1312 22.5164 22.1187 22.5164 22.1061 22.5164C21.4539 22.5164 20.8519 22.75 20.4004 23.1804C19.9739 23.5985 19.7231 24.1765 19.7231 24.7914C19.698 26.0703 20.739 27.1279 22.0183 27.1402C22.0309 27.1402 22.0434 27.1402 22.056 27.1402ZM22.0685 24.0781C22.3068 24.0781 22.5075 24.1642 22.658 24.3118C22.7959 24.4594 22.8712 24.6438 22.8712 24.8529C22.8712 25.271 22.52 25.603 22.0936 25.603C22.0936 25.603 22.0936 25.603 22.081 25.603C21.8553 25.603 21.6546 25.5169 21.5041 25.3694C21.3661 25.2218 21.2909 25.025 21.2909 24.816C21.2909 24.4102 21.6421 24.0781 22.0685 24.0781Z" fill="white"/>
          <path d="M27.5091 25.6277C27.5091 25.6277 27.5217 25.6277 27.5342 25.6277C28.1864 25.6277 28.8135 25.3571 29.265 24.9021C29.704 24.4594 29.9298 23.8937 29.9172 23.3035C29.8921 22.0122 28.8511 20.9792 27.5718 20.9792C27.5593 20.9792 27.5468 20.9792 27.5342 20.9792C26.882 20.9915 26.2674 21.2498 25.8159 21.7048C25.3895 22.1475 25.1637 22.7132 25.1763 23.3281C25.2014 24.5947 26.2424 25.6277 27.5091 25.6277ZM26.7566 23.2912C26.7566 23.0821 26.8444 22.8977 26.9949 22.7501C27.1454 22.6025 27.3335 22.5287 27.5217 22.5287C27.5217 22.5287 27.5217 22.5287 27.5342 22.5287C27.9857 22.5287 28.3495 22.8854 28.3495 23.3035C28.3495 23.5002 28.2617 23.6847 28.1112 23.8323C27.9481 23.9921 27.7474 24.0536 27.5468 24.0659C27.0952 24.0659 26.7441 23.7216 26.7566 23.2912Z" fill="white"/>
          <path d="M22.6674 37.089C22.6799 37.089 22.6924 37.089 22.6924 37.089C23.9843 37.0767 25.0253 36.0314 25.0253 34.7648C25.0127 33.4736 23.9717 32.4652 22.6548 32.4529H22.6423C22.0277 32.4529 21.4257 32.6988 20.9867 33.1415C20.5352 33.5842 20.2969 34.1622 20.2969 34.7648C20.2969 35.4043 20.5603 35.9946 21.0118 36.4373C21.4508 36.8554 22.0402 37.089 22.6674 37.089ZM21.8647 34.7525C21.8772 34.3344 22.2409 34.0024 22.6674 34.0024C22.8806 34.0024 23.0687 34.0884 23.2192 34.236C23.3697 34.3836 23.445 34.5803 23.445 34.7894C23.445 35.2075 23.0812 35.5395 22.6548 35.5395C22.4541 35.5395 22.2409 35.4535 22.0904 35.2936C21.9399 35.146 21.8647 34.9493 21.8647 34.7525Z" fill="white"/>
        </svg>
      `,
    ),
  }));

  get organisationName(): string {
    const org = this.program()?.organisation;
    if (org && typeof org === 'object' && 'name' in org) {
      return (org as { name?: string }).name ?? '';
    }
    return '';
  }

  protected readonly vetIcons = vetIcons;
}
